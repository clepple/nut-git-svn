# Network UPS Tools: clients

# directories
prefix		= @prefix@
exec_prefix	= @exec_prefix@

CGIPATH		= $(DESTDIR)@CGIPATH@
BINPATH		= $(DESTDIR)@bindir@
SBINPATH	= $(DESTDIR)@sbindir@

# for install-lib, at the bottom
LIBDIR		= $(DESTDIR)@libdir@
INCLUDEDIR	= $(DESTDIR)@includedir@

# other definitions
CC	 = @CC@
AR	 = @AR@
RANLIB	 = @RANLIB@
CFLAGS	 = -I../include @CFLAGS@
PROGS	 = upsc upslog upsrw upscmd
SPROGS	 = upsmon upssched
CGIPROGS = upsstats.cgi upsimage.cgi upsset.cgi
LDFLAGS  = @LDFLAGS@
LIBDEP   = @LIBOBJ@
LIBOBJ	 = $(LIBDEP) @NETLIBS@

SSL_CFLAGS  = @SSL_CFLAGS@
SSL_LDFLAGS = @SSL_LDFLAGS@
NET_CFLAGS  = $(CFLAGS) $(SSL_CFLAGS)
NET_LDFLAGS = $(LDFLAGS) $(SSL_LDFLAGS)
GD_INCLUDES = @GD_INCLUDES@
GD_LIBS     = @GD_LIBS@
UPSCLI_OBJ  = @UPSCLI_OBJ@

INSTALLCMD  = @INSTALL@
INSTALLMODE = 0755

all: $(PROGS) $(SPROGS)
cgi: $(CGIPROGS)

libupsclient.a: upsclient.o ../common/parseconf.o
	$(AR) rv libupsclient.a upsclient.o ../common/parseconf.o
	$(RANLIB) libupsclient.a

upsclient.o: upsclient.c
	$(CC) $(NET_CFLAGS) -c upsclient.c

upsc: upsc.c $(UPSCLI_OBJ) $(LIBDEP)
	$(CC) $(NET_CFLAGS) -o upsc upsc.c $(UPSCLI_OBJ) $(LIBOBJ) $(NET_LDFLAGS)

upscmd: upscmd.c $(UPSCLI_OBJ) $(LIBDEP)
	$(CC) $(NET_CFLAGS) -o upscmd upscmd.c $(UPSCLI_OBJ) $(LIBOBJ) $(NET_LDFLAGS)

upsrw: upsrw.c $(UPSCLI_OBJ) $(LIBDEP)
	$(CC) $(NET_CFLAGS) -o upsrw upsrw.c $(UPSCLI_OBJ) $(LIBOBJ) $(NET_LDFLAGS)

upslog: upslog.c $(UPSCLI_OBJ) $(LIBDEP)
	$(CC) $(NET_CFLAGS) -o upslog upslog.c $(UPSCLI_OBJ) $(LIBOBJ) $(NET_LDFLAGS)

upsstats.cgi: upsstats.c $(UPSCLI_OBJ) cgilib.o $(LIBDEP)
	$(CC) $(NET_CFLAGS) -o upsstats.cgi upsstats.c $(UPSCLI_OBJ) cgilib.o $(LIBOBJ) $(NET_LDFLAGS)

upsimage.cgi: upsimage.c $(UPSCLI_OBJ) cgilib.o $(LIBDEP)
	$(CC) $(NET_CFLAGS) $(GD_INCLUDES) -o upsimage.cgi upsimage.c $(UPSCLI_OBJ) cgilib.o $(GD_LIBS) $(LIBOBJ) $(NET_LDFLAGS)

upsset.cgi: upsset.c $(UPSCLI_OBJ) cgilib.o $(LIBDEP)
	$(CC) $(NET_CFLAGS) -o upsset.cgi upsset.c $(UPSCLI_OBJ) cgilib.o $(LIBOBJ) $(NET_LDFLAGS)

upsmon: upsmon.c $(UPSCLI_OBJ) $(LIBDEP)
	$(CC) $(NET_CFLAGS) -o upsmon upsmon.c $(UPSCLI_OBJ) $(LIBOBJ) $(NET_LDFLAGS)

# other stuff

upssched: upssched.c ../common/parseconf.o $(LIBDEP)
	$(CC) $(CFLAGS) -o upssched upssched.c ../common/parseconf.o $(LIBOBJ) $(LDFLAGS)

cgilib.o: cgilib.c
	$(CC) $(CFLAGS) -c cgilib.c

clean:
	rm -f *~ *.o *.a $(PROGS) $(SPROGS) $(CGIPROGS) @MISC_UPSCLI_OBJ@

distclean: clean

install: all
	@for f in $(PROGS) ; do \
		$(INSTALLCMD) -m $(INSTALLMODE) $$f $(BINPATH); \
	done
	@for f in $(SPROGS) ; do \
		$(INSTALLCMD) -m $(INSTALLMODE) $$f $(SBINPATH); \
	done

install-cgi-bin: cgi
	@for f in $(CGIPROGS) ; do \
		$(INSTALLCMD) -m $(INSTALLMODE) $$f $(CGIPATH); \
	done

install-lib: libupsclient.a
	@if (test ! -d $(LIBDIR)) then \
		../install-sh -d $(LIBDIR) || exit 1; \
	fi
	@if (test ! -d $(INCLUDEDIR)) then \
		../install-sh -d $(INCLUDEDIR) || exit 1; \
	fi
	$(INSTALLCMD) -m 0644 upsclient.h $(INCLUDEDIR)
	$(INSTALLCMD) -m 0644 libupsclient.a $(LIBDIR)
	$(INSTALLCMD) -m 0644 ../include/parseconf.h $(INCLUDEDIR)

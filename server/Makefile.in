# Network UPS Tools: server

# directories
prefix		= @prefix@
exec_prefix	= @exec_prefix@

SBINPATH	= $(DESTDIR)@sbindir@

# other definitions
CC	= @CC@
CFLAGS	= -I../include @CFLAGS@
PROGS	= upsd
NETLIBS	= @NETLIBS@
LIBOBJ	= @LIBOBJ@
STRLCPY = @STRLCPY@

NETOBJ  = netget.o netmisc.o netlist.o netuser.o netset.o netinstcmd.o
UPSDOBJ	= upsd.o user.o conf.o ssl.o sstate.o access.o $(NETOBJ) \
		desc.o ../common/state.o ../lib/libupsconfig.a \
		../common/parseconf.o

SSL_CFLAGS  = @SSL_CFLAGS@
SSL_LDFLAGS = @SSL_LDFLAGS@

INSTALLCMD = @INSTALL@
INSTALLMODE = 0755

all: $(PROGS)

upsd: $(UPSDOBJ) $(LIBOBJ)
	$(CC) $(CFLAGS) $(SSL_CFLAGS) -o upsd $(UPSDOBJ) \
		$(NETLIBS) $(LIBOBJ) $(SSL_LDFLAGS)

upsd.o: upsd.c
	$(CC) $(CFLAGS) $(SSL_CFLAGS) -c upsd.c

ssl.o: ssl.c
	$(CC) $(CFLAGS) $(SSL_CFLAGS) -c ssl.c

conf.o: conf.c
	$(CC) $(CFLAGS) $(SSL_CFLAGS) -c conf.c

netget.o: netget.c
	$(CC) $(CFLAGS) $(SSL_CFLAGS) -c netget.c

netmisc.o: netmisc.c
	$(CC) $(CFLAGS) $(SSL_CFLAGS) -c netmisc.c

netlist.o: netlist.c
	$(CC) $(CFLAGS) $(SSL_CFLAGS) -c netlist.c

netuser.o: netuser.c
	$(CC) $(CFLAGS) $(SSL_CFLAGS) -c netuser.c

netset.o: netset.c
	$(CC) $(CFLAGS) $(SSL_CFLAGS) -c netset.c

netinstcmd.o: netinstcmd.c
	$(CC) $(CFLAGS) $(SSL_CFLAGS) -c netinstcmd.c

sockdebug: sockdebug.c
	$(CC) $(CFLAGS) -o sockdebug sockdebug.c $(LIBOBJ) ../common/parseconf.o
 
clean:
	rm -f *~ *.o upsd sockdebug

distclean: clean

install: all
	@for f in $(PROGS) ; do \
		echo $(INSTALLCMD) $$f $(SBINPATH); \
		$(INSTALLCMD) $$f $(SBINPATH); \
	done
